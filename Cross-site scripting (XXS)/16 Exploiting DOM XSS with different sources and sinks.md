# 16. Exploiting DOM XSS with different sources and sinks

## ğŸ”„ **Source-to-Sink Execution Path**

In principle, a website is vulnerable to **DOM-based cross-site scripting** if there is an executable path via which data can propagate from **source to sink**.

In practice, however:

- Different sources and sinks have varying behavior and exploitability.
- Web scripts often apply sanitization or validation, which can obstruct straightforward exploitation.

---

## ğŸ§ª Common DOM XSS Sinks & Payload Techniques

### ğŸ“ `document.write` Sink

- Works with `<script>` tags.
- Allows a **simple payload**, such as:

```html
<script>alert(1)</script>

```

âš ï¸ *However*, some usage contexts require payloads to account for existing HTML structures (e.g., closing tags first).

---

### ğŸ§± `innerHTML` Sink

- **Does not allow `<script>` elements** in modern browsers.
- Also, `<svg onload>` events **do not fire**.

âœ… Recommended approach:

```html
element.innerHTML = '<img src=1 onerror=alert(document.domain)>';

```

Use elements like `<img>` or `<iframe>` with inline event handlers (`onload`, `onerror`) for successful exploitation.

---

## ğŸ“¦ Sources & Sinks in Third-Party Dependencies

Modern applications often rely on **third-party libraries** such as jQuery, AngularJS, etc., which may themselves contain vulnerable sources/sinks.

---

### ğŸ’¡ DOM XSS in jQuery

### ğŸ“Œ Example 1: `attr()` as a Sink

```jsx
$(function() {
  $('#backLink').attr("href", (new URLSearchParams(window.location.search)).get('returnUrl'));
});

```

ğŸ§¨ **Exploit**: Supply a malicious URL to the `returnUrl` parameter:

```
?returnUrl=javascript:alert(document.domain)

```

This manipulates the `href`, and the payload executes when the user clicks the link.

---

### ğŸ“Œ Example 2: `$()` Selector Sink

A classic jQuery XSS vector used `location.hash` to auto-scroll or animate elements:

```jsx
$(window).on('hashchange', function() {
  var element = $(location.hash);
  element[0].scrollIntoView();
});

```

âœ… **Exploitation via iframe**:

```html
<iframe src="https://vulnerable-website.com#"
        onload="this.src+='<img src=1 onerror=alert(1)>'">
</iframe>

```

> Note: Modern versions of jQuery block HTML injection when the string begins with #, but older code may still be vulnerable.
> 

---

### âš™ï¸ DOM XSS in AngularJS

AngularJS executes code inside **double curly braces** (`{{ }}`) within elements marked with `ng-app`.

ğŸ”“ This allows JavaScript execution **without needing `<script>` tags or inline events**, especially in attribute contexts or interpolated content.